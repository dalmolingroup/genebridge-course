[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "GeneBridge: Inferring the Evolutionary Rooting of Orthologous Genes",
    "section": "",
    "text": "1 GeneBridge: Inferring the Evolutionary Rooting of Orthologous Genes",
    "crumbs": [
      "<span class='chapter-number'>1</span>¬† <span class='chapter-title'>GeneBridge</span>"
    ]
  },
  {
    "objectID": "index.html#lesson-overview",
    "href": "index.html#lesson-overview",
    "title": "GeneBridge: Inferring the Evolutionary Rooting of Orthologous Genes",
    "section": "1.1 Lesson overview",
    "text": "1.1 Lesson overview\nüîí License: Creative Commons Attribution Share Alike 4.0 International License\nüë• Target Audience: Researchers, graduate students, and biologists interested in evolutionary analysis.\nüì∂ Level: Intermediate\n‚¨ÖÔ∏è Prerequisites To be able to follow this course, learners should have knowledge in:\n\nBasic knowledge of the R programming language (loading libraries, handling data frames).\nFamiliarity with fundamental concepts in evolutionary biology (e.g., genes, orthologs, phylogenetic trees).\nBeing comfortable working with RStudio or a similar R environment.\n\nüìñ Description This repository contains the materials for the course ‚ÄúGeneBridge: Inferring the Evolutionary Rooting of Orthologous Genes,‚Äù organized by from Dalmolin‚Äôs Systems Biology Group, based at the Bioinformatics Multidisciplinary Environment (BioME) at UFRN. This workshop is divided into three parts: (1) Performing the Rooting Analysis, (2) Plotting Rooted Genes, and (3) Plotting Abundances.\n‚û°Ô∏è Learning Outcomes: By the end of the course, learners will be able to:\n\nUnderstand the theoretical basis of evolutionary rooting and the Bridge algorithm. [Understanding]\nApply the GeneBridge package to infer the evolutionary root for a set of orthologous genes. [Applying]\nAnalyze and interpret the output tables and rooting results. [Analysing]\nCreate and customize plots to visualize rooted genes on a phylogenetic tree. [Creating]\nGenerate and evaluate plots of gene abundances across different clades. [Evaluating]\n\n‚åõ Time estimation: 180 minutes\n‚öôÔ∏è Requirements: Participants must have a laptop with a recent version of R and RStudio installed. Specific R package dependencies (e.g., GeneBridge) are detailed in the repository‚Äôs setup instructions.\nüôè Acknowledgements:\n\nBioinformatics Multidisciplinary Environment (BioME - IMD/UFRN)\nPostgraduate Program in Bioinformatics (PPg-Bioinfo - UFRN)",
    "crumbs": [
      "<span class='chapter-number'>1</span>¬† <span class='chapter-title'>GeneBridge</span>"
    ]
  },
  {
    "objectID": "analysis/01_gene_rooting.html",
    "href": "analysis/01_gene_rooting.html",
    "title": "2¬† Gene Rooting",
    "section": "",
    "text": "2.1 Importing Packages\nlibrary(GeneBridge)\nlibrary(geneplast.data)\nlibrary(readr)\nlibrary(dplyr)\nlibrary(purrr)\nlibrary(biomaRt)\nlibrary(magrittr)\nlibrary(KEGGREST)\nlibrary(ape)\nlibrary(tidyverse)\nlibrary(data.table)\nlibrary(stringi)\nlibrary(AnnotationHub)\nlibrary(sourcetools)\nlibrary(here)",
    "crumbs": [
      "<span class='chapter-number'>2</span>¬† <span class='chapter-title'>Gene Rooting</span>"
    ]
  },
  {
    "objectID": "analysis/01_gene_rooting.html#defining-functions-for-later-use",
    "href": "analysis/01_gene_rooting.html#defining-functions-for-later-use",
    "title": "2¬† Gene Rooting",
    "section": "2.2 Defining functions for later use",
    "text": "2.2 Defining functions for later use\nThe first one searches for the respective protein ID for each gene in the input list. The second returns the interactions between these proteins, and the last one filters the interactions by a combined confidence score greater than 0.4.\n\n# get IDs from STRING DB\nget_string_ids &lt;- function(genes_hgnc, species_id = \"9606\") {\n\n    req &lt;- RCurl::postForm(\n    \"https://string-db.org/api/tsv/get_string_ids\",\n    identifiers = paste(genes_hgnc, collapse = \"%0D\"),\n    echo_query = \"1\",\n    species = species_id,\n    .opts = list(ssl.verifypeer = FALSE)\n  )\n  \n  map_ids &lt;- read.table(text = req, sep = \" \", header = TRUE, quote = \"\") %&gt;%\n    dplyr::select(-queryIndex) %&gt;%\n    unique()\n  \n  map_ids$stringId &lt;- substring(map_ids$stringId, 6, 1000)\n  \n  return(map_ids)\n}\n\n # Get STRING interactions\n get_network_interaction &lt;- function(map_ids, protein_id, species_id = \"9606\") {\n \n   identifiers &lt;- map_ids %&gt;% pull(protein_id) %&gt;% na.omit %&gt;% paste0(collapse=\"%0d\")\n \n   req2 &lt;- RCurl::postForm(\n     \"https://string-db.org/api/tsv/network\",\n     identifiers = identifiers,\n     required_core = \"0\",\n     species = species_id,\n     .opts = list(ssl.verifypeer = FALSE)\n   )\n   \n   int_network &lt;- read.table(text = req2, sep = \"   \", header = TRUE)\n   \n   int_network &lt;- unique(int_network)\n   \n   return(int_network)\n }\n\n ## Recomputing scores\ncombine_scores &lt;- function(dat, evidences = \"all\", confLevel = 0.4) {\n  if(evidences[1] == \"all\"){\n    edat&lt;-dat[,-c(1,2,ncol(dat))]\n  } else {\n    if(!all(evidences%in%colnames(dat))){\n      stop(\"NOTE: one or more 'evidences' not listed in 'dat' colnames!\")\n    }\n    edat&lt;-dat[,evidences]\n  }\n  if (any(edat &gt; 1)) {\n    edat &lt;- edat/1000\n  }\n  edat&lt;-1-edat\n  sc&lt;- apply(X = edat, MARGIN = 1, FUN = function(x) 1-prod(x))\n  dat &lt;- cbind(dat[,c(1,2)],combined_score = sc)\n  idx &lt;- dat$combined_score &gt;= confLevel\n  dat &lt;-dat[idx,]\n  return(dat)\n}",
    "crumbs": [
      "<span class='chapter-number'>2</span>¬† <span class='chapter-title'>Gene Rooting</span>"
    ]
  },
  {
    "objectID": "analysis/01_gene_rooting.html#loading-gene-list-and-orthology-data",
    "href": "analysis/01_gene_rooting.html#loading-gene-list-and-orthology-data",
    "title": "2¬† Gene Rooting",
    "section": "2.3 Loading gene list and orthology data",
    "text": "2.3 Loading gene list and orthology data\nWe load the orthology data through AnnotationHub, this R package provides a central place where genomic files (VCF, bed, wig) and other resources from standard locations (e.g., UCSC, Ensembl) can be accessed. This way, we have access to the input files for the GeneBridge algorithm.\n\n# Load the Gene Set Table\nsensorial_genes &lt;- read.csv(here(\"data/sensorial_genes.csv\"))\n\n# Query Phylotree and OG data\nah &lt;- AnnotationHub()\nmeta &lt;- query(ah, \"geneplast\")\nload(meta[[\"AH83116\"]])\n\nhead(sensorial_genes)\nhead(cogdata)",
    "crumbs": [
      "<span class='chapter-number'>2</span>¬† <span class='chapter-title'>Gene Rooting</span>"
    ]
  },
  {
    "objectID": "analysis/01_gene_rooting.html#pre-processing",
    "href": "analysis/01_gene_rooting.html#pre-processing",
    "title": "2¬† Gene Rooting",
    "section": "2.4 1. Pre-processing",
    "text": "2.4 1. Pre-processing\n\n2.4.1 1.1. Mapping\nFor the next analyses, we need to cross-reference information between our genes of interest (Gene IDs from the sensorial_genes table) and Protein IDs (from the cogdata table). The STRINGdb API is used to map Gene IDs to Protein IDs, allowing the filtering of genes of interest in the cogdata table. The final goal is to obtain a filtered set of sensory genes with their respective pathways and COG IDs.\n\nmap_ids &lt;- get_string_ids(sensorial_genes$gene_symbol)\n\n# Subsetting cogs of interest - Sensorial Genes\ngene_cogs &lt;- cogdata %&gt;%\n  filter(ssp_id %in% map_ids$ncbiTaxonId) %&gt;%\n  filter(protein_id %in% map_ids[[\"stringId\"]]) %&gt;%\n  group_by(protein_id) %&gt;%\n  summarise(n = n(), cog_id = paste(cog_id, collapse = \" / \"))\n\nhead(map_ids)\n\n#map_ids |&gt; \n#  vroom::vroom_write(file = here(\"data/map_ids.csv\"), delim = \",\")\n\n\n\n2.4.2 1.2. Resolving duplicate COGs\nDue to evolutionary events such as gene duplication, some genes may be associated with more than one Cluster of Orthologous Groups (COG). To ensure the functionality of the algorithm, it is necessary to resolve these cases, prioritizing COGs according to the following criteria:\n\nPriority by COG type:\n\n\nKOGs have higher priority.\nCOGs have higher priority than NOGs.\n\n\nCases with COGs starting with the same letter:\n\n\nAre resolved manually, based on the annotated function of the COG and the scientific question of the study.\n\nThe code below implements this resolution and integrates the corrections into the main table.\n\ngene_cogs %&gt;% filter(n &gt; 1)\n\n# Resolving main proteins\ngene_cogs_resolved &lt;- tribble(\n  ~protein_id, ~cog_id,\n\"ENSP00000332500\", \"NOG274749\", #NOG274749 / NOG274749\n\"ENSP00000409316\", \"NOG282909\", #NOG282909 / NOG282909 / NOG282909\n\"ENSP00000480090\", \"KOG3599\"    #KOG3599 / KOG3272\n)\n\n# Removing unresolved cases and adding manual assignments\ngene_cogs %&lt;&gt;%\n  filter(n == 1) %&gt;%\n dplyr:: select(-n) %&gt;%\n  bind_rows(gene_cogs_resolved)\n\n#gene_cogs |&gt; \n#  vroom::vroom_write(file = here(\"data/gene_cogs.csv\"), delim = \",\")",
    "crumbs": [
      "<span class='chapter-number'>2</span>¬† <span class='chapter-title'>Gene Rooting</span>"
    ]
  },
  {
    "objectID": "analysis/01_gene_rooting.html#processing",
    "href": "analysis/01_gene_rooting.html#processing",
    "title": "2¬† Gene Rooting",
    "section": "2.5 3. Processing",
    "text": "2.5 3. Processing\nThe objective of this step is to perform the rooting of the genes of interest using the GeneBridge package. For this, we use the newBridge, runBridge, and runPermutation functions, which produce statistical results associated with the selected COGs in a phylogenetic tree.\n\n2.5.1 3.1. Necessary Inputs\n\nogdata:\n\nDataset containing three main columns:\n\nProtein ID: Protein identifiers.\nCOG ID: Clusters of interest.\nSpecie ID: Species identifiers.\n\nIn the example, the cogdata object is being used.\n\nphyloTree:\n\nPhylogenetic tree containing 476 eukaryotes, representing the evolutionary structure among the analyzed species.\n\nogids:\n\nList of COGs of interest. This set is derived from the gene_cogs table and includes the COGs associated with the proteins after the previous processing.\n\nrefsp:\n\nReference species for rooting. In the example, we use 9606 (human).\n\n\nThe getBridge function extracts the results generated by GeneBridge in table format. The res table contains the statistical results of the rooting.\n\n## Run GeneBridge\ncogs_of_interest &lt;- gene_cogs %&gt;% pull(cog_id) %&gt;% unique\n\nogr &lt;- newBridge(ogdata=cogdata, phyloTree=phyloTree, ogids = cogs_of_interest, refsp=\"9606\")\n\nogr &lt;- runBridge(ogr, penalty = 2, threshold = 0.5, verbose = TRUE)\n\nogr &lt;- runPermutation(ogr, nPermutations=1000, verbose=FALSE)\n\nres &lt;- getBridge(ogr, what=\"results\")\n\nsaveRDS(ogr, file = here(\"data/ogr.RData\"))",
    "crumbs": [
      "<span class='chapter-number'>2</span>¬† <span class='chapter-title'>Gene Rooting</span>"
    ]
  },
  {
    "objectID": "analysis/01_gene_rooting.html#post-processing",
    "href": "analysis/01_gene_rooting.html#post-processing",
    "title": "2¬† Gene Rooting",
    "section": "2.6 4. Post-processing",
    "text": "2.6 4. Post-processing\nAfter performing the rooting with GeneBridge, it is necessary to adjust the data to improve the visualization and interpretation of the results. In this step, we add the names of the clades to the identified roots, using an external table that relates the root identifiers to the clade names.\n\n# naming the rooted clades\nCLADE_NAMES &lt;- \"https://raw.githubusercontent.com/dalmolingroup/neurotransmissionevolution/ctenophora_before_porifera/analysis/geneplast_clade_names.tsv\"\n\nlca_names &lt;- vroom::vroom(CLADE_NAMES)\n\ngroot_df &lt;- res %&gt;%\n  tibble::rownames_to_column(\"cog_id\") %&gt;%\n  dplyr::select(cog_id, root = Root) %&gt;%\n  left_join(lca_names) %&gt;%\n  inner_join(gene_cogs)\n\nhead(groot_df)\n\n#groot_df |&gt; \n#  vroom::vroom_write(file = here(\"data/groot_df.csv\"), delim = \",\")\n\n\n2.6.1 4.1. Protein-Protein Interaction Network\nThe construction of a protein-protein interaction (PPI) network is an essential step to identify the functional relationships between proteins. In this process, we use the STRINGdb API, a database that catalogs interactions between proteins based on various sources, including experimental assays, co-expression, and evidence extracted from scientific publications.\nThe STRINGdb API offers methods to: - Obtain protein interactions for a list of proteins. - Select specific sources of evidence. - Calculate and combine scores based on the selected evidence.\nMore information about the API can be found in the STRING API documentation.\n\n# Get proteins interaction\nstring_edgelist &lt;- get_network_interaction(groot_df)\n\n# Recomputing scores\nstring_edgelist &lt;- combine_scores(string_edgelist,\n                                  evidences = c(\"ascore\", \"escore\", \"dscore\"),\n                                  confLevel = 0.7)\n\ncolnames(string_edgelist) &lt;- c(\"stringId_A\", \"stringId_B\", \"combined_score\")\n\n# Remove the species id\nstring_edgelist$stringId_A &lt;- substring(string_edgelist$stringId_A, 6, 1000)\nstring_edgelist$stringId_B &lt;- substring(string_edgelist$stringId_B, 6, 1000)\n\n# How many edgelist proteins are absent in gene_ids? (should return 0)\nsetdiff(\n  string_edgelist %$% c(stringId_A, stringId_B),\n  map_ids %&gt;% pull(stringId)\n)\n\nhead(string_edgelist)\n\nFor the construction of the graph, in addition to the interactions between the proteins, it is necessary that each node is annotated with additional information that will be used in the analysis, such as: - Protein name. - Clade where it is rooted. - Metabolic pathway in which it participates.\n\n## Create anotation table\nnodelist &lt;- data.frame(node = unique(c(string_edgelist$stringId_A, string_edgelist$stringId_B)))\n\nmerged_paths &lt;- merge(nodelist, groot_df, by.x = \"node\", by.y = \"protein_id\")\n\npivotada &lt;- sensorial_genes %&gt;%\n  dplyr::select(gene_symbol, pathway_name) %&gt;%\n  dplyr::mutate(n = 1) %&gt;%\n  tidyr::pivot_wider(\n    id_cols = gene_symbol,\n    names_from = pathway_name,\n    values_from = n,\n    values_fn = list(n = length),\n    values_fill = list(n = 0),\n  )\n\nsource_statements &lt;-\n  colnames(pivotada)[2:length(pivotada)]\n\nnodelist &lt;-\n  nodelist %&gt;%\n  left_join(merged_paths, by = c(\"node\" = \"node\")) %&gt;%\n  left_join(map_ids, by = c(\"node\" = \"stringId\")) %&gt;%\n  left_join(pivotada, by = c(\"queryItem\" = \"gene_symbol\"))\n\nhead(nodelist)\n\nIn addition to the graph structure, we can calculate metrics such as the number of connections (degree) of each node.\n\n# Network Metrics\nconnected_nodes &lt;- rle(sort(c(string_edgelist[,1], string_edgelist[,2])))\nconnected_nodes &lt;- data.frame(count=connected_nodes$lengths, node=connected_nodes$values)\nconnected_nodes &lt;- left_join(nodelist, connected_nodes, by = c(\"node\" = \"node\"))\nconnected_nodes &lt;- dplyr::select(connected_nodes, queryItem, root, clade_name, count)\n\nhead(connected_nodes)\n\n\n#nodelist |&gt; \n#  vroom::vroom_write(file = here(\"data/nodelist.csv\"), delim = \",\")\n#string_edgelist |&gt; \n#  vroom::vroom_write(file = here(\"data/string_edgelist.csv\"), delim = \",\")\n#merged_paths |&gt; \n#  vroom::vroom_write(file = here(\"data/merged_paths.csv\"), delim = \",\")",
    "crumbs": [
      "<span class='chapter-number'>2</span>¬† <span class='chapter-title'>Gene Rooting</span>"
    ]
  },
  {
    "objectID": "analysis/02_plotting_roots.html",
    "href": "analysis/02_plotting_roots.html",
    "title": "3¬† Plotting Roots",
    "section": "",
    "text": "3.1 Import libraries\nlibrary(ggplot2)\nlibrary(ggraph)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(igraph)\nlibrary(purrr)\nlibrary(vroom)\nlibrary(paletteer)\nlibrary(easylayout)\nlibrary(UpSetR)\nlibrary(tinter)\nlibrary(here)\nlibrary(dplyr)",
    "crumbs": [
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Plotting Roots</span>"
    ]
  },
  {
    "objectID": "analysis/02_plotting_roots.html#define-functions",
    "href": "analysis/02_plotting_roots.html#define-functions",
    "title": "3¬† Plotting Roots",
    "section": "3.2 Define functions",
    "text": "3.2 Define functions\n\n# Set colors\ncolor_mappings &lt;- c(\n  \"Olfactory transduction\"   = \"#8dd3c7\",\n  \"Taste transduction\"      = \"#72874EFF\",\n  \"Phototransduction\"       = \"#fb8072\"\n)\n\nsubset_graph_by_root &lt;-\n  function(geneplast_result, root_number, graph) {\n    filtered &lt;- geneplast_result %&gt;%\n      filter(root &gt;= root_number) %&gt;%\n      pull(node)\n    \n    induced_subgraph(graph, which(V(graph)$name %in% filtered))\n  }\n\nadjust_color_by_root &lt;- function(geneplast_result, root_number, graph) {\n  filtered &lt;- geneplast_result %&gt;%\n    filter(root == root_number) %&gt;%\n    pull(node)\n  \n  V(graph)$color &lt;- ifelse(V(graph)$name %in% filtered, \"black\", \"gray\")\n  return(graph)\n}\n\n# Configure graph colors by genes incrementation\nsubset_and_adjust_color_by_root &lt;- function(geneplast_result, root_number, graph) {\n  subgraph &lt;- subset_graph_by_root(geneplast_result, root_number, graph)\n  adjusted_graph &lt;- adjust_color_by_root(geneplast_result, root_number, subgraph)\n  return(adjusted_graph)\n}\n\nplot_network &lt;- function(graph, title, nodelist, xlims, ylims, legend = \"none\") {\n  \n  # Generate color map\n  source_statements &lt;-\n    colnames(nodelist)[10:length(nodelist)]\n  \n  color_mappings &lt;- c(\n    \"Olfactory transduction\"   = \"#8dd3c7\",\n    \"Taste transduction\"      = \"#72874EFF\",\n    \"Phototransduction\"       = \"#fb8072\"\n  )\n  \n  vertices &lt;- igraph::as_data_frame(graph, \"vertices\")\n  \n  ggraph:: ggraph(graph,\n                  \"manual\",\n                  x = V(graph)$x,\n                  y = V(graph)$y) +\n    ggraph::geom_edge_link0(edge_width = 1, color = \"#90909020\") +\n    ggraph::geom_node_point(ggplot2::aes(color = I(V(graph)$color)), size = 2) +\n    scatterpie::geom_scatterpie(\n      aes(x=x, y=y, r=18),\n      cols = source_statements,\n      data = vertices[rownames(vertices) %in% V(graph)$name[V(graph)$color == \"black\"],],\n      colour = NA,\n      pie_scale = 1\n    ) +\n    geom_node_text(aes(label = ifelse(V(graph)$color == \"black\", V(graph)$queryItem, NA)), \n                   nudge_x = 1, nudge_y = 1, size = 0.5, colour = \"black\") +\n    ggplot2::scale_fill_manual(values = color_mappings, drop = FALSE) +\n    ggplot2::coord_fixed() +\n    ggplot2::scale_x_continuous(limits = xlims) +\n    ggplot2::scale_y_continuous(limits = ylims) +\n    ggplot2::theme_void() +\n    ggplot2::theme(\n      legend.position = legend,\n      legend.key.size = ggplot2::unit(0.5, 'cm'),\n      legend.key.height = ggplot2::unit(0.5, 'cm'),\n      legend.key.width = ggplot2::unit(0.5, 'cm'),\n      legend.title = ggplot2::element_text(size=6),\n      legend.text = ggplot2::element_text(size=6),\n      panel.border = ggplot2::element_rect(\n        colour = \"#161616\",\n        fill = NA,\n        linewidth = 1\n      ),\n      plot.title = ggplot2::element_text(size = 8, face = \"bold\")\n    ) +\n    ggplot2::guides(\n      color = \"none\",\n      fill = \"none\"\n    ) +\n    ggplot2::labs(fill = \"Source:\", title = title)\n}",
    "crumbs": [
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Plotting Roots</span>"
    ]
  },
  {
    "objectID": "analysis/02_plotting_roots.html#loading-necessary-tables",
    "href": "analysis/02_plotting_roots.html#loading-necessary-tables",
    "title": "3¬† Plotting Roots",
    "section": "3.3 Loading necessary tables",
    "text": "3.3 Loading necessary tables\n\n#Load data (need to save tables from first qmd)\nnodelist &lt;- vroom::vroom(file = here(\"data/nodelist.csv\"), delim = \",\")\nstring_edgelist &lt;- vroom::vroom(file = here(\"data/string_edgelist.csv\"), delim = \",\")\nmerged_paths &lt;- vroom::vroom(file = here(\"data/merged_paths.csv\"), delim = \",\")",
    "crumbs": [
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Plotting Roots</span>"
    ]
  },
  {
    "objectID": "analysis/02_plotting_roots.html#visualization-with-upset-plot",
    "href": "analysis/02_plotting_roots.html#visualization-with-upset-plot",
    "title": "3¬† Plotting Roots",
    "section": "3.4 1. Visualization with UpSet Plot",
    "text": "3.4 1. Visualization with UpSet Plot\nThe UpSet Plot is a useful tool to visualize the distribution and concatenation of genes between different metabolic pathways. It allows identifying how genes are shared or exclusive among the analyzed categories.\n\nupset(dplyr::select(as.data.frame(nodelist), \n                            \"Olfactory transduction\",\n                            \"Taste transduction\",\n                            \"Phototransduction\"),\n                    nsets = 50, nintersects = NA,\n      sets.bar.color = c(\"#8dd3c7\", \"#72874EFF\", \"#fb8072\"), \n      mainbar.y.label = \"Biological Process \\nIntersections\",\n      sets.x.label = \"Set Size\")",
    "crumbs": [
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Plotting Roots</span>"
    ]
  },
  {
    "objectID": "analysis/02_plotting_roots.html#visualization-of-the-protein-protein-interaction-network",
    "href": "analysis/02_plotting_roots.html#visualization-of-the-protein-protein-interaction-network",
    "title": "3¬† Plotting Roots",
    "section": "3.5 2. Visualization of the Protein-Protein Interaction Network",
    "text": "3.5 2. Visualization of the Protein-Protein Interaction Network\nThe visualization of the interaction network is essential to understand the functional connections between proteins. Here, we use the easylayout package, developed by Danilo Imparato, to generate an efficient layout. This package organizes the network nodes in x and y coordinates, allowing a structured and clear visualization. Subsequently, the graph will be plotted with ggraph.\n\n## Graph Build\n#graph &lt;-\n#  graph_from_data_frame(string_edgelist, directed = FALSE, vertices = nodelist)\n\n#layout &lt;- easylayout::easylayout(graph)\n#V(graph)$x &lt;- layout[, 1]\n#V(graph)$y &lt;- layout[, 2]\n\n#save(graph, file = \"../data/graph_layout\")\n\n\n3.5.1 2.1. Visualization of the Ancestry of Each Node\nThe analysis of the ancestry of each node in the network provides an evolutionary view of the analyzed proteins. Here, we use ggraph to plot the graph with the positions previously saved by easylayout.\nThe nodes are colored according to the distance from the last common ancestor (LCA) of the analyzed clades and the human (Human-LCA). The darker shade indicates older clades in relation to humans, while light shades of blue represent newer clades, closer to the Human-LCA.\n\nload(here(\"data/graph_layout\"))\n\nggraph(graph, \"manual\", x = V(graph)$x, y = V(graph)$y) +\n  geom_edge_link0(color = \"#90909020\") +  \n  geom_node_point(aes(color = -root), size = 2) +  \n  theme_void() + \n  theme(legend.position = \"left\")\n\n\n\n\n\n\n\n\n\n\n3.5.2 2.2. Visualization of the Protein-Protein Interaction Network in Human\nTo better understand the relationship between human proteins, we plot the interaction network where the nodes represent the human genes associated with their biological processes.\n\n3.5.2.1 Description of the graph elements:\n\nNodes (Circles): The colors of the nodes are divided according to the biological processes assigned to each gene. The use of pie charts allows the visualization of genes that participate in multiple processes.\nEdges (Lines): Represent the protein interactions based on data from STRINGdb.\nGene labels: Each node is annotated with the corresponding gene symbol, strategically positioned for easy reading.\n\n\n## Plotting Human PPI Network\n#ppi_labaled &lt;-\nggraph::ggraph(graph,\n               \"manual\",\n               x = V(graph)$x,\n               y = V(graph)$y) +\n  ggraph:: geom_edge_link0(edge_width = 0.5, color = \"#90909020\") +\n  scatterpie::geom_scatterpie(\n    cols = colnames(nodelist[10:12]),\n    data = igraph::as_data_frame(graph, \"vertices\"),\n    colour = NA,\n    pie_scale = 0.40\n  ) +\n  geom_node_text(aes(label = nodelist$queryItem), colour = \"black\", nudge_x = 0.8, nudge_y = 0.8, size = 2) +\n  ggplot2::scale_fill_manual(values = color_mappings, drop = FALSE)\n\n\n\n\n\n\n\n#ppi &lt;- \n  ggraph::ggraph(graph,\n               \"manual\",\n               x = V(graph)$x,\n               y = V(graph)$y) +\n  ggraph:: geom_edge_link0(edge_width = 0.5, color = \"#90909020\") +\n  scatterpie::geom_scatterpie(\n    cols = colnames(nodelist[10:12]),\n    data = igraph::as_data_frame(graph, \"vertices\"),\n    colour = NA,\n    pie_scale = 0.40\n  ) +\n  ggplot2::scale_fill_manual(values = color_mappings, drop = FALSE)\n\n\n\n\n\n\n\n\n\n\n\n3.5.3 2.3. Visualization of the Protein-Protein Interaction Network in Each Clade\nIn this section, we visualize the genes that are statistically rooted in each clade. The arrangement of the genes allows us to observe the increment of orthologous genes as a function of the complexity and antiquity of the biological system.\n\n3.5.3.1 Visualization features:\n\nEvolution of the graphs: The graphs are organized from left to right and from top to bottom, allowing the analysis of the evolutionary progression.\nNode coloring: The color of the nodes indicates the level of ancestry, as previously highlighted, where darker tones represent older clades and lighter tones indicate evolutionary proximity to humans.\nOrganisms of interest: In addition to visualizing all clades, it is possible to generate graphs focused only on certain groups, such as Metamonada, Choanoflagellata, Cephalochordata, and Amphibia.\n\nWith these visualizations, it is possible to identify patterns of gene evolution in different clades and perform detailed comparisons with organisms of specific interest.\n\ngeneplast_roots &lt;- merged_paths[order(merged_paths$root), ]\n  \n\nbuffer &lt;- c(-50, 50)\nxlims &lt;- ceiling(range(V(graph)$x)) + buffer\nylims &lt;- ceiling(range(V(graph)$y)) + buffer\n\nroots &lt;- unique(geneplast_roots$root) %&gt;%\n  set_names(unique(geneplast_roots$clade_name))\n\n# Subset graphs by LCAs\nsubsets &lt;-\n  map(roots, ~ subset_and_adjust_color_by_root(geneplast_roots, .x, graph))\n\n# Plot titles\ntitles &lt;- names(roots)\n\nplots &lt;-\n  map2(\n    subsets,\n    titles,\n    plot_network,\n    nodelist = nodelist,\n    xlims = xlims,\n    ylims = ylims,\n    legend = \"right\"\n  ) %&gt;%\n  discard(is.null)\n\n#net_all_roots &lt;-\npatchwork::wrap_plots(\n  rev(plots),\n  nrow = 4,\n  ncol = 4\n)\n\n\n\n\n\n\n\n#ggsave(file = \"../data/network_rooting.svg\", plot=net_all_roots, width=10, height=8)\n\n\npatchwork::wrap_plots(\n  plots$Metamonada, plots$Choanoflagellata, plots$Cephalochordata, plots$Amphibia,\n  ncol = 4\n)",
    "crumbs": [
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Plotting Roots</span>"
    ]
  },
  {
    "objectID": "analysis/03_plotting_abundances.html",
    "href": "analysis/03_plotting_abundances.html",
    "title": "4¬† Plotting Abundance",
    "section": "",
    "text": "4.1 Importing Packages\nlibrary(here)\nlibrary(readr)\nlibrary(magrittr)\nlibrary(ggplot2)\nlibrary(hrbrthemes)\nlibrary(tinter)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(AnnotationHub)",
    "crumbs": [
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Plotting Abundance</span>"
    ]
  },
  {
    "objectID": "analysis/03_plotting_abundances.html#defining-functions",
    "href": "analysis/03_plotting_abundances.html#defining-functions",
    "title": "4¬† Plotting Abundance",
    "section": "4.2 Defining functions",
    "text": "4.2 Defining functions\nThese functions are intended to organize the annotation of the vertices of our nodelist and calculate the cumulative number of genes per clade and per biological process.\n\ncalculate_cumulative_genes &lt;- function(nodelist) {\n  \n    # Get all possible categories of clade_name\n  all_clades &lt;- node_annotation %&gt;%\n    arrange(desc(root)) %&gt;%\n    dplyr:: select(clade_name) %&gt;%\n    unique()\n  \n  # Define the columns of interest\n  process_columns &lt;- c(\"queryItem\", \"root\", \"clade_name\", \n                       \"Olfactory transduction\", \n                       \"Taste transduction\",           \n                       \"Phototransduction\")\n  \n  # Calculate the cumulative sum grouping by clade_name\n  cumulative_genes &lt;- nodelist %&gt;%\n    arrange(desc(root)) %&gt;%\n    dplyr::select(all_of(process_columns)) %&gt;%\n    group_by(clade_name, root) %&gt;%\n    summarise(count_genes = n(), .groups = \"drop\") %&gt;%\n    arrange(desc(root)) %&gt;%\n    mutate(cumulative_sum = cumsum(count_genes)) %&gt;%\n    right_join(all_clades, by = \"clade_name\") %&gt;%\n    fill(cumulative_sum, .direction = \"down\")\n  \n  return(cumulative_genes)\n}\n\ncalculate_cumulative_bp &lt;- function(nodelist) {\n    \n  # Get all possible categories of clade_name\n  all_clades &lt;- node_annotation %&gt;%\n    arrange(desc(root)) %&gt;%\n    dplyr:: select(clade_name) %&gt;%\n    unique()\n  \n   # Define the columns of interest\n  process_columns &lt;- c(\"queryItem\", \"root\", \"clade_name\", \n                       \"Olfactory transduction\", \n                       \"Taste transduction\",           \n                       \"Phototransduction\")\n  \n  # Calculate the cumulative sum for each biological process\n  cumulative_bp &lt;- nodelist %&gt;%\n    dplyr::select(all_of(process_columns)) %&gt;%\n    distinct(root, queryItem, .keep_all = TRUE) %&gt;%\n    mutate(across(all_of(process_columns[-c(1:3)]), ~ as.numeric(.))) %&gt;%\n    group_by(root, clade_name) %&gt;%\n    summarise(across(all_of(process_columns[-c(1:3)]), \n                     ~ sum(. , na.rm = TRUE)),\n              .groups = \"drop\") %&gt;%\n    arrange(desc(root)) %&gt;%\n    mutate(across(all_of(process_columns[-c(1:3)]), ~ cumsum(.))) %&gt;%\n    right_join(all_clades, by = \"clade_name\") %&gt;%\n    fill(everything(), .direction = \"down\")\n  \n  return(cumulative_bp)\n}",
    "crumbs": [
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Plotting Abundance</span>"
    ]
  },
  {
    "objectID": "analysis/03_plotting_abundances.html#defining-aesthetic-parameters-for-ggplot",
    "href": "analysis/03_plotting_abundances.html#defining-aesthetic-parameters-for-ggplot",
    "title": "4¬† Plotting Abundance",
    "section": "4.3 Defining aesthetic parameters for ggplot",
    "text": "4.3 Defining aesthetic parameters for ggplot\nAssigning default colors for the metabolic pathways in the analysis and defining the other aesthetic standards for plotting.\n\n# Plotting colors and labels\nannotation_colors &lt;- c(\n  \"Olfactory transduction\"   = \"#8dd3c7\",\n  \"Taste transduction\"      = \"#72874EFF\",\n  \"Phototransduction\"       = \"#fb8072\"\n)\n\nannotation_labels &lt;- c(\n  \"Olfactory transduction\"   = \"Olfactory transduction\",\n  \"Taste transduction\"      = \"Taste transduction\",\n  \"Phototransduction\"       = \"Phototransduction\"\n)\n\n# This vertical line indicates the first metazoan (Amphimedon queenslandica / Ctenophora)\nchoanoflagellata_line &lt;- geom_vline(\n  xintercept = \"Sphaeroforma arctica\",\n  color      = \"#FF0000\",\n  linetype   = \"11\",\n  alpha      = 1,\n  linewidth  = 0.25\n)\n\n# Plotting\ntheme_main &lt;- theme(\n  panel.spacing      = unit(2.5, \"pt\"),\n  strip.background   = element_blank(),\n  panel.grid.major.x = element_blank(),\n  panel.grid.major.y = element_line(linewidth = 0.25, linetype = \"dotted\", color = \"#E0E0E0\"),\n  strip.text.x       = element_text(size = 9, angle = 90, hjust = 0, vjust = 0.5, color = \"#757575\"),\n  strip.text.y       = element_text(size = 10, angle = 0, hjust = 0, vjust = 0.5, color = \"#757575\"),\n  axis.title         = element_text(size = 15, color = \"#424242\"),\n  axis.ticks.x       = element_blank(),\n  axis.text.x        = element_blank(),\n  axis.text.y        = element_text(size = 5.5),\n  legend.position    = \"none\"\n)\n\ntheme_supplementary &lt;- theme(\n  panel.grid.major.x = element_line(color = \"#E0E0E0\", linewidth = 0.25, linetype = \"dotted\"),\n  panel.grid.major.y = element_blank(),\n  strip.text.y       = element_text(size = 7, angle = 0, hjust = 0, vjust = 0.5, color = \"#757575\"),\n  strip.text.x       = element_text(size = 7, angle = 90, hjust = 0, vjust = 0.5, color = \"#757575\"),\n  axis.title         = element_text(size = 12, color = \"#424242\"),\n  axis.ticks         = element_line(colour = \"grey20\"),\n  axis.text.y        = element_text(size = 6, angle = 0, hjust = 1, vjust = 0.5, color = \"#757575\"),\n  axis.text.x        = element_text(size = 6)\n)\n\ntheme_average &lt;- theme(\n  panel.spacing      = unit(1, \"pt\"),\n  axis.title         = element_text(color = \"#424242\"),\n  axis.text          = element_text(color = \"#757575\"),\n  axis.text.x        = element_text(size = 7, angle = -45, vjust = 0, hjust = 0),\n  axis.text.y        = element_text(size = 5),\n  strip.background   = element_blank(),\n  strip.text         = element_text(color = \"#757575\"),\n  strip.text.y       = element_text(angle = 0, hjust = 0, vjust = 0.5)\n)\n\ntheme_big &lt;- theme(\n  panel.spacing      = unit(0.5, \"pt\"),\n  panel.grid.major.x = element_line(linewidth = 0.1, linetype = \"dashed\"),\n  panel.grid.major.y = element_blank(),\n  strip.background   = element_blank(),\n  strip.text.x       = element_text(size = 8, angle = 90, hjust = 0.5, vjust = 0),\n  strip.text.y       = element_text(size = 8, angle = 0, hjust = 0, vjust = 0.5),\n  axis.text.x        = element_text(size = 6, angle = 90, vjust = 0, hjust = 0),\n  axis.text.y        = element_text(size = 4.5),\n  axis.ticks         = element_line(size = 0.1)\n)\n\ntick_function &lt;- function(x) {\n  seq(x[2], 0, length.out = 3) %&gt;% head(-1) %&gt;% tail(-1) %&gt;% { ceiling(./5)*5 }\n}",
    "crumbs": [
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Plotting Abundance</span>"
    ]
  },
  {
    "objectID": "analysis/03_plotting_abundances.html#load-necessary-tables",
    "href": "analysis/03_plotting_abundances.html#load-necessary-tables",
    "title": "4¬† Plotting Abundance",
    "section": "4.4 Load necessary tables",
    "text": "4.4 Load necessary tables\nTo proceed with the analysis, it is necessary to load a table containing the taxid information for each species. This information will be used later to map the taxid of the species with the taxid of each COG.\n\n4.4.1 Table Description\n\nFile Name: string_eukaryotes.rda\nContent: Taxonomic information of eukaryotic species.\n\nThe table loads the following main fields: - TaxID (taxonomic identifier): A unique identifier associated with each species. - Species name\n\n# Query Phylotree and OG data\nah &lt;- AnnotationHub()\nmeta &lt;- query(ah, \"geneplast\")\nload(meta[[\"AH83116\"]])\n\n# TODO: save tables from previous qmds\nnodelist &lt;- vroom::vroom(file = here(\"data/nodelist.csv\"), delim = \",\")\ngene_cogs &lt;-  vroom::vroom(file = here(\"data/gene_cogs.csv\"), delim = \",\")\nsensorial_genes &lt;- read.csv(here(\"data/sensorial_genes.csv\"))\nmap_ids &lt;- vroom::vroom(here(\"data/map_ids.csv\"))\ngroot_df &lt;- vroom::vroom(here(\"data/groot_df.csv\"))\n\nogr &lt;- readRDS(here(\"data/ogr.RData\"))\n\nload(here(\"data/string_eukaryotes.rda\"))\nhead(string_eukaryotes)",
    "crumbs": [
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Plotting Abundance</span>"
    ]
  },
  {
    "objectID": "analysis/03_plotting_abundances.html#visualization-rooting-pattern",
    "href": "analysis/03_plotting_abundances.html#visualization-rooting-pattern",
    "title": "4¬† Plotting Abundance",
    "section": "4.5 Visualization: Rooting Pattern",
    "text": "4.5 Visualization: Rooting Pattern\nThis visualization allows analyzing the cumulative pattern of gene emergence over evolutionary time. In addition, it also shows the growth of biological processes separated by each metabolic pathway.\n\n4.5.1 Graph Characteristics\n\nBar Chart (Cumulative Pattern):\n\nRepresents the cumulative sum of genes associated with each clade.\nEach bar displays the total accumulated genes in a given clade, allowing the identification of the diversification pattern.\n\nCombined Chart (Bars and Lines):\n\nThe bars indicate the cumulative sum of genes per clade.\nThe lines represent the growth of different biological processes (Process), separated by metabolic pathways, allowing the comparison between the cumulative emergence of genes and the development of biological functions.\n\n\n\n\n4.5.2 Interpretation\n\nCumulative Pattern: The bar chart shows how genes have emerged over time, cumulatively. This view helps to identify moments of greater genetic diversification.\nComparison by Biological Processes: The combined chart allows observing which biological processes stand out at different moments of evolution and how they are related to the emergence of new genes.\n\n\n# Mapping roots and proteins info\nnode_annotation &lt;- nodelist %&gt;%\n  inner_join(gene_cogs, by = c(\"node\" = \"protein_id\", \"cog_id\")) %&gt;%\n  inner_join(sensorial_genes, by = c(\"queryItem\" = \"gene_symbol\")) %&gt;%\n  distinct(queryItem, cog_id, pathway_name, root, clade_name)\n\ncumulative_genes &lt;- calculate_cumulative_genes(nodelist) \ncumulative_bp &lt;- calculate_cumulative_bp(nodelist)\n  \ncumulative_data &lt;- left_join(cumulative_genes, cumulative_bp)\n \n\nlong_data &lt;- cumulative_data %&gt;%\n  pivot_longer(cols = 5:7, \n               names_to = \"Process\", \n               values_to = \"Value\")\n\n#a &lt;-\nggplot() +\n  # Bar chart for cumulative_sum\n  geom_bar(data = cumulative_data, \n           aes(x = factor(clade_name, levels = clade_name), y = cumulative_sum), \n           stat = \"identity\", fill = \"darkgray\", colour = NA) +\n  geom_text(data = cumulative_data, \n            aes(x = factor(clade_name, levels = clade_name), y = cumulative_sum, label = cumulative_sum), \n            vjust = -0.5, size = 3, color = \"darkgray\") +\n  scale_color_manual(values = annotation_colors) +\n  \n  labs(x = \"Clade Name\", y = \"Cumulative Sum\", \n       title = \"Cumulative Sum and Biological Processes\",\n       fill = \"Cumulative Sum\",\n       color = \"Biological Processes\") +\n  \n  theme_main +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1))\n\n\n\n\n\n\n\n#b &lt;- \nggplot() +\n  # Bar chart for cumulative_sum\n  geom_bar(data = cumulative_data, \n           aes(x = factor(-root), y = cumulative_sum), \n           stat = \"identity\", fill = \"darkgray\", colour = NA) +\n  geom_text(data = cumulative_data, \n            aes(x = factor(-root), y = cumulative_sum, label = cumulative_sum), \n            vjust = -0.5, size = 3, color = \"darkgray\") +\n  \n  # Line chart for biological processes\n  geom_line(data = long_data, \n            aes(x = factor(-root), y = Value, color = Process, group = Process), \n            size = 1) +\n  \n  # Use the defined color palette\n  scale_color_manual(values = annotation_colors) +\n  \n  labs(x = \"Clade Name\", y = \"Cumulative Sum\", \n       title = \"Cumulative Sum and Biological Processes\",\n       fill = \"Cumulative Sum\",\n       color = \"Biological Processes\") +\n  \n  theme_main +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n\n\n\n\n\n\n\n#ggsave(file = \"\", plot=a, width=15, height=8)\n#ggsave(file = \"\", plot=b, width=15, height=8)",
    "crumbs": [
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Plotting Abundance</span>"
    ]
  },
  {
    "objectID": "analysis/03_plotting_abundances.html#calculation-of-cog-abundance-by-function-in-species",
    "href": "analysis/03_plotting_abundances.html#calculation-of-cog-abundance-by-function-in-species",
    "title": "4¬† Plotting Abundance",
    "section": "4.6 Calculation of COG Abundance by Function in Species",
    "text": "4.6 Calculation of COG Abundance by Function in Species\nThis analysis is based on the premise that similar COGs share the same biological function. Thus, it is possible to calculate the average abundance of functions associated with COGs in each species, using the number of COGs present in the species identified by the TaxID.\n\n4.6.1 Calculation Steps\n\nSpecies Mapping Each species was mapped to its respective clade (hierarchical level) based on the TaxID information.\n\nThe ogr@spbranches table was used to associate species (ssp_id) with their branches (lca).\nThe data was organized to include the order of the TaxIDs.\n\nCOG Annotation\n\nThe relationship between proteins and genes was enriched with functional information, such as COG identifiers and metabolic pathway names (pathway_name).\nDuplicates were removed to ensure that only unique information was considered.\n\nIntegration of Species Information\n\nA mapping was created between species (TaxID) and their respective clades to add the relevant taxonomic information.\nThe species were ordered based on their clades, to facilitate hierarchical analysis.\n\nCalculation of Average Abundance by Function\n\nFor each species and metabolic function (pathway_name), the average abundance of COGs was calculated.\nAdditional information, such as species names (ncbi_name) and clades (clade_name), was integrated into the result.\n\nAbundance Adjustment (Capping)\n\nTo avoid extreme values, the average abundance was adjusted:\n\nValues above a limit (mean + 3 standard deviations) were truncated to 100.\nThe adjusted values were calculated separately by metabolic function.\n\n\n\n\nlca_spp &lt;- ogr@spbranches %&gt;%\n  rename(\"taxid\" = ssp_id, \"species\" = ssp_name, \"lca\" = \"branch\") %&gt;%\n  mutate(taxid_order = row_number()) %&gt;%\n  dplyr::select(lca, taxid, taxid_order)\n\nclade_taxids &lt;- lca_spp\nclade_names &lt;- vroom::vroom(\"https://raw.githubusercontent.com/dalmolingroup/neurotransmissionevolution/ctenophora_before_porifera/analysis/geneplast_clade_names.tsv\")\n\ncog_annotation &lt;- map_ids %&gt;%\n  left_join(groot_df, by = c(\"stringId\" = \"protein_id\")) %&gt;%\n  left_join(sensorial_genes, by = c(\"queryItem\" = \"gene_symbol\")) %&gt;%\n  distinct(queryItem, cog_id, pathway_name) %&gt;%\n  dplyr::select(cog_id, pathway_name) %&gt;%\n  unique() %&gt;%\n  na.omit()\n\ncog_abundance_by_taxid &lt;- cogdata %&gt;%\n  filter(cog_id %in% nodelist[[\"cog_id\"]]) %&gt;%\n  count(ssp_id, cog_id, name = \"abundance\") %&gt;%\n  left_join(cog_annotation, by = \"cog_id\")\n\n# Mapping species to clade info\nordered_species &lt;- string_eukaryotes %&gt;%\n  dplyr::select(taxid, ncbi_name) %&gt;%\n  left_join(clade_taxids, by = \"taxid\") %&gt;%\n  left_join(clade_names, by = c(\"lca\" = \"root\")) %&gt;%\n  na.omit() %&gt;% unique() %&gt;%\n  arrange(desc(lca)) %&gt;%\n  dplyr::select(-taxid_order)\n  \navg_abundance_by_function &lt;- cog_abundance_by_taxid %&gt;%\n  group_by(ssp_id, pathway_name) %&gt;%\n  summarise(avg_abundance = mean(abundance)) %&gt;%\n  ungroup() %&gt;%\n  # Adding species and clade info\n  left_join(ordered_species %&gt;% mutate(taxid = as.double(taxid)), by = c(\"ssp_id\" = \"taxid\")) %&gt;%\n  unique() %&gt;%\n  arrange(desc(lca)) %&gt;%\n  mutate(ncbi_name = factor(ncbi_name, levels = unique(ncbi_name)),\n         clade_name = factor(clade_name, levels = unique(clade_name))) %&gt;%\n  na.omit()\n\ncapped_abundance_by_function &lt;- avg_abundance_by_function %&gt;%\n  # mutate(capped_abundance = ifelse(abundance &gt;= 100, 100, abundance)) %&gt;%\n  group_by(pathway_name) %&gt;%\n  mutate(\n    # max_abundance = max(abundance[lca &lt;= 29])\n    max_abundance = avg_abundance[lca &lt;= 29] %&gt;% { mean(.) + 3*sd(.) }\n    ,abundance     = ifelse(avg_abundance &gt;= max_abundance, pmin(max_abundance, 100), pmin(avg_abundance, 100)))\n\n# List of signatures\nsignatures &lt;- unique(node_annotation$pathway_name)\n\nroots_seq &lt;- node_annotation %&gt;%\n  arrange(desc(root)) %&gt;%\n  dplyr:: select(root, clade_name) %&gt;%\n  unique()\n\nroots_seq$clade_name &lt;- factor(roots_seq$clade_name, levels = roots_seq$clade_name)\n\n\n\n4.6.2 Visualization\nIn the following graphs, it is possible to observe the average abundance of COGs in each clade. Each bar represents a species within the respective clade, while the colors indicate the different metabolic functions associated with the orthologous groups.\n\n4.6.2.1 Graph of Average COG Abundance by Clade\n\nThe X axis represents the species.\nThe Y axis indicates the average abundance of proteins in orthologous groups.\nThe bars are colored according to the metabolic function (pathway_name).\n\n\n\n4.6.2.2 Graph with Adjusted Abundance (Capped)\n\nTo avoid distortions caused by extreme values, the abundance was adjusted to a maximum limit (mean + 3 standard deviations).\nThis graph provides a more balanced visualization, especially for metabolic functions with very high values.\n\n\n# Plotting by species\nggplot(avg_abundance_by_function) +\n  # Geoms  ----------------\nchoanoflagellata_line +\n  geom_bar(\n    aes(x = ncbi_name, y = avg_abundance, fill = pathway_name, color = after_scale(darken(fill, 0.1)))\n    ,stat = \"identity\"\n  ) +\n  # Labels  ---------------\n xlab(\"Species\") +\n  ylab(\"Average protein abundance in orthologous groups\") +\n  #ylab(\"Average protein abundance in orthologous groups\") +\n  # Scales ----------------\nscale_y_continuous(breaks = tick_function, minor_breaks = NULL) +\n  scale_fill_manual(values = annotation_colors %&gt;% darken(0.1)) +\n  # Styling ---------------\nfacet_grid(\n  pathway_name ~ clade_name\n  ,scales   = \"free\"\n  ,space    = \"free\"\n  ,labeller = labeller(annotation = annotation_labels)\n) +\n  theme_classic() + \n  theme_main\n\n\n\n\n\n\n\n# Plotting by species capped\nggplot(capped_abundance_by_function) +\n  # Geoms  ----------------\nchoanoflagellata_line +\n  geom_bar(\n    aes(x = ncbi_name, y = abundance, fill = pathway_name, color = after_scale(darken(fill, 0.1)))\n    ,stat = \"identity\"\n  ) +\n  # Labels  ---------------\n  xlab(\"Species\") +\n  ylab(\"Average protein abundance in orthologous groups\") +\n  #ylab(\"Average protein abundance in orthologous groups\") +\n  # Scales ----------------\n  scale_y_continuous(breaks = tick_function, minor_breaks = NULL) +\n  scale_fill_manual(values = annotation_colors %&gt;% darken(0.1)) +\n  # Styling ---------------\nfacet_grid(\n  pathway_name ~ clade_name\n  ,scales   = \"free\"\n  ,space    = \"free\"\n  ,labeller = labeller(annotation = annotation_labels)\n) +\n  theme_classic() + \n  theme_main\n\n\n\n\n\n\n\n\n\n\n4.6.2.3 Simplified Visualization: Abundance by Clade\nFor a less detailed analysis, it is possible to visualize the average abundance of COGs only at the clade level, ignoring the differences between individual species. This graph provides a more direct overview, ideal for identifying global trends.\n\nThe X axis represents the clades.\nThe Y axis shows the average abundance of proteins in orthologous groups per clade.\nThe bars are grouped by clade and colored according to the metabolic functions (pathway_name).\n\n\n# Ploting by clade\nggplot(avg_abundance_by_function) +\n  geom_bar(\n    aes(x = clade_name, y = avg_abundance, fill = pathway_name, color = after_scale(darken(fill, 0.1)))\n    ,stat = \"summary\"\n    ,fun  = \"mean\"\n  ) +\n  scale_y_continuous(breaks = tick_function, minor_breaks = NULL) +\n  scale_fill_manual(values = annotation_colors, guide = \"none\") +\n  facet_grid(\n    pathway_name ~ .\n    ,scales   = \"free\"\n    ,space    = \"free_y\"\n    ,labeller = labeller(annotation = sub(\"\\n\", \"\", annotation_labels))\n  ) +\n  xlab(\"Clades\") +\n  ylab(\"Average abundance by clade\") +\n  theme_classic() + \n  theme_average",
    "crumbs": [
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Plotting Abundance</span>"
    ]
  },
  {
    "objectID": "analysis/04_orthoguide.html",
    "href": "analysis/04_orthoguide.html",
    "title": "5¬† OrthoGuide: Pre-computed Gene Rooting Data",
    "section": "",
    "text": "6 OrthoGuide: Pre-computed Gene Rooting Data\nOrthoGuide is available at https://dalmolingroup.imd.ufrn.br/orthoguide/ and provides immediate access to high-quality, pre-computed rooting data for 8 species. Instead of running complex analyses, users can query this database and get the information they need in seconds, along with a few exploratory plots.",
    "crumbs": [
      "<span class='chapter-number'>5</span>¬† <span class='chapter-title'>OrthoGuide: Pre-computed Gene Rooting Data</span>"
    ]
  },
  {
    "objectID": "analysis/04_orthoguide.html#how-orthoguide-works",
    "href": "analysis/04_orthoguide.html#how-orthoguide-works",
    "title": "5¬† OrthoGuide: Pre-computed Gene Rooting Data",
    "section": "6.1 How OrthoGuide Works",
    "text": "6.1 How OrthoGuide Works\nAll data in the database is generated using the GeneBridge R package (v0.99.2). The gene-to-COG (Clusters of Orthologous Groups) information was obtained from STRING-db version 11.0.",
    "crumbs": [
      "<span class='chapter-number'>5</span>¬† <span class='chapter-title'>OrthoGuide: Pre-computed Gene Rooting Data</span>"
    ]
  }
]